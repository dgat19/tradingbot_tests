{"version":3,"file":"electron-context.js","sources":["../../../src/main/integrations/electron-context.ts"],"sourcesContent":["import { defineIntegration } from '@sentry/core';\nimport { app } from 'electron';\n\nimport { getDefaultEnvironment, getDefaultReleaseName } from '../context';\nimport { mergeEvents } from '../merge';\n\nfunction getAppMemory(): number {\n  return app.getAppMetrics().reduce((acc, metric) => acc + metric.memory.workingSetSize * 1024, 0);\n}\n\nexport const electronContextIntegration = defineIntegration(() => {\n  return {\n    name: 'ElectronContext',\n    processEvent(event, _, client) {\n      // We don't want to send the server_name as it includes the machine name which is potentially PII\n      delete event.server_name;\n      delete event.tags?.server_name;\n      // We delete the Node runtime context so our Electron runtime context is used instead\n      delete event.contexts?.runtime;\n\n      // Electron is multi-process so the Node process memory will be inaccurate\n      delete event.contexts?.app?.app_memory;\n\n      // The user agent is parsed by Sentry and would overwrite certain context\n      // information, which we don't want. Generally remove it, since we know that\n      // we are browsing with Chrome.\n      if (event.request?.headers) {\n        delete event.request.headers['User-Agent'];\n      }\n\n      const { release = getDefaultReleaseName(), environment = getDefaultEnvironment() } = client.getOptions();\n\n      return mergeEvents(\n        {\n          contexts: {\n            app: {\n              app_name: app.name || app.getName(),\n              app_version: app.getVersion(),\n              build_type: process.mas ? 'app-store' : process.windowsStore ? 'windows-store' : undefined,\n              app_memory: getAppMemory(),\n              app_arch: process.arch,\n            },\n            browser: {\n              name: 'Chrome',\n            },\n            chrome: {\n              name: 'Chrome',\n              type: 'runtime',\n              version: process.versions.chrome,\n            },\n            device: {\n              family: 'Desktop',\n            },\n            node: {\n              name: 'Node',\n              type: 'runtime',\n              version: process.versions.node,\n            },\n            runtime: {\n              name: 'Electron',\n              version: process.versions.electron,\n            },\n          },\n          environment,\n          release,\n          tags: {\n            'event.origin': 'electron',\n            'event.environment': 'javascript',\n            'event.process': 'browser',\n          },\n        },\n        event,\n      );\n    },\n  };\n});\n"],"names":[],"mappings":";;;;;AAMA,SAAS,YAAY,GAAA;IACnB,OAAO,GAAG,CAAC,aAAa,EAAE,CAAC,MAAM,CAAC,CAAC,GAAG,EAAE,MAAM,KAAK,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,cAAc,GAAG,IAAI,EAAE,CAAC,CAAC;AAClG;AAEa,MAAA,0BAA0B,GAAG,iBAAiB,CAAC,MAAK;IAC/D,OAAO;AACL,QAAA,IAAI,EAAE,iBAAiB;AACvB,QAAA,YAAY,CAAC,KAAK,EAAE,CAAC,EAAE,MAAM,EAAA;;YAE3B,OAAO,KAAK,CAAC,WAAW;AACxB,YAAA,OAAO,KAAK,CAAC,IAAI,EAAE,WAAW;;AAE9B,YAAA,OAAO,KAAK,CAAC,QAAQ,EAAE,OAAO;;AAG9B,YAAA,OAAO,KAAK,CAAC,QAAQ,EAAE,GAAG,EAAE,UAAU;;;;AAKtC,YAAA,IAAI,KAAK,CAAC,OAAO,EAAE,OAAO,EAAE;gBAC1B,OAAO,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,YAAY,CAAC;AAC3C;AAED,YAAA,MAAM,EAAE,OAAO,GAAG,qBAAqB,EAAE,EAAE,WAAW,GAAG,qBAAqB,EAAE,EAAE,GAAG,MAAM,CAAC,UAAU,EAAE;AAExG,YAAA,OAAO,WAAW,CAChB;AACE,gBAAA,QAAQ,EAAE;AACR,oBAAA,GAAG,EAAE;wBACH,QAAQ,EAAE,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC,OAAO,EAAE;AACnC,wBAAA,WAAW,EAAE,GAAG,CAAC,UAAU,EAAE;wBAC7B,UAAU,EAAE,OAAO,CAAC,GAAG,GAAG,WAAW,GAAG,OAAO,CAAC,YAAY,GAAG,eAAe,GAAG,SAAS;wBAC1F,UAAU,EAAE,YAAY,EAAE;wBAC1B,QAAQ,EAAE,OAAO,CAAC,IAAI;AACvB,qBAAA;AACD,oBAAA,OAAO,EAAE;AACP,wBAAA,IAAI,EAAE,QAAQ;AACf,qBAAA;AACD,oBAAA,MAAM,EAAE;AACN,wBAAA,IAAI,EAAE,QAAQ;AACd,wBAAA,IAAI,EAAE,SAAS;AACf,wBAAA,OAAO,EAAE,OAAO,CAAC,QAAQ,CAAC,MAAM;AACjC,qBAAA;AACD,oBAAA,MAAM,EAAE;AACN,wBAAA,MAAM,EAAE,SAAS;AAClB,qBAAA;AACD,oBAAA,IAAI,EAAE;AACJ,wBAAA,IAAI,EAAE,MAAM;AACZ,wBAAA,IAAI,EAAE,SAAS;AACf,wBAAA,OAAO,EAAE,OAAO,CAAC,QAAQ,CAAC,IAAI;AAC/B,qBAAA;AACD,oBAAA,OAAO,EAAE;AACP,wBAAA,IAAI,EAAE,UAAU;AAChB,wBAAA,OAAO,EAAE,OAAO,CAAC,QAAQ,CAAC,QAAQ;AACnC,qBAAA;AACF,iBAAA;gBACD,WAAW;gBACX,OAAO;AACP,gBAAA,IAAI,EAAE;AACJ,oBAAA,cAAc,EAAE,UAAU;AAC1B,oBAAA,mBAAmB,EAAE,YAAY;AACjC,oBAAA,eAAe,EAAE,SAAS;AAC3B,iBAAA;aACF,EACD,KAAK,CACN;SACF;KACF;AACH,CAAC;;;;"}