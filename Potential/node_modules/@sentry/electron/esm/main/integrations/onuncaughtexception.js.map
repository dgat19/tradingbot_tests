{"version":3,"file":"onuncaughtexception.js","sources":["../../../src/main/integrations/onuncaughtexception.ts"],"sourcesContent":["import { captureException, defineIntegration } from '@sentry/core';\nimport { NodeClient } from '@sentry/node';\nimport { dialog } from 'electron';\n\n/** Capture unhandled errors. */\nexport const onUncaughtExceptionIntegration = defineIntegration(() => {\n  return {\n    name: 'OnUncaughtException',\n    setup(client: NodeClient) {\n      const options = client.getOptions();\n\n      global.process.on('uncaughtException', (error: Error) => {\n        captureException(error, {\n          originalException: error,\n          captureContext: {\n            level: 'fatal',\n          },\n          data: {\n            mechanism: {\n              handled: false,\n              type: 'generic',\n            },\n          },\n        });\n\n        client.flush(options.shutdownTimeout || 2000).then(\n          () => {\n            if (options?.onFatalError) {\n              options.onFatalError(error);\n            } else if (global.process.listenerCount('uncaughtException') <= 2) {\n              // In addition to this handler there is always one in Electron\n              // The dialog is only shown if there are no other handlers\n              // eslint-disable-next-line no-console\n              console.error('Uncaught Exception:');\n              // eslint-disable-next-line no-console\n              console.error(error);\n              const ref = error.stack;\n              const stack = ref !== undefined ? ref : `${error.name}: ${error.message}`;\n              const message = `Uncaught Exception:\\n${stack}`;\n              dialog.showErrorBox('A JavaScript error occurred in the main process', message);\n            }\n          },\n          () => {\n            // ignore\n          },\n        );\n      });\n    },\n  };\n});\n"],"names":[],"mappings":";;;AAIA;AACa,MAAA,8BAA8B,GAAG,iBAAiB,CAAC,MAAK;IACnE,OAAO;AACL,QAAA,IAAI,EAAE,qBAAqB;AAC3B,QAAA,KAAK,CAAC,MAAkB,EAAA;AACtB,YAAA,MAAM,OAAO,GAAG,MAAM,CAAC,UAAU,EAAE;YAEnC,MAAM,CAAC,OAAO,CAAC,EAAE,CAAC,mBAAmB,EAAE,CAAC,KAAY,KAAI;gBACtD,gBAAgB,CAAC,KAAK,EAAE;AACtB,oBAAA,iBAAiB,EAAE,KAAK;AACxB,oBAAA,cAAc,EAAE;AACd,wBAAA,KAAK,EAAE,OAAO;AACf,qBAAA;AACD,oBAAA,IAAI,EAAE;AACJ,wBAAA,SAAS,EAAE;AACT,4BAAA,OAAO,EAAE,KAAK;AACd,4BAAA,IAAI,EAAE,SAAS;AAChB,yBAAA;AACF,qBAAA;AACF,iBAAA,CAAC;AAEF,gBAAA,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,eAAe,IAAI,IAAI,CAAC,CAAC,IAAI,CAChD,MAAK;oBACH,IAAI,OAAO,EAAE,YAAY,EAAE;AACzB,wBAAA,OAAO,CAAC,YAAY,CAAC,KAAK,CAAC;AAC5B;yBAAM,IAAI,MAAM,CAAC,OAAO,CAAC,aAAa,CAAC,mBAAmB,CAAC,IAAI,CAAC,EAAE;;;;AAIjE,wBAAA,OAAO,CAAC,KAAK,CAAC,qBAAqB,CAAC;;AAEpC,wBAAA,OAAO,CAAC,KAAK,CAAC,KAAK,CAAC;AACpB,wBAAA,MAAM,GAAG,GAAG,KAAK,CAAC,KAAK;wBACvB,MAAM,KAAK,GAAG,GAAG,KAAK,SAAS,GAAG,GAAG,GAAG,CAAA,EAAG,KAAK,CAAC,IAAI,KAAK,KAAK,CAAC,OAAO,CAAA,CAAE;AACzE,wBAAA,MAAM,OAAO,GAAG,CAAwB,qBAAA,EAAA,KAAK,EAAE;AAC/C,wBAAA,MAAM,CAAC,YAAY,CAAC,iDAAiD,EAAE,OAAO,CAAC;AAChF;iBACF,EACD,MAAK;;AAEL,iBAAC,CACF;AACH,aAAC,CAAC;SACH;KACF;AACH,CAAC;;;;"}