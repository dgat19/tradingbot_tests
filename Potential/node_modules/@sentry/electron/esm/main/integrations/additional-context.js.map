{"version":3,"file":"additional-context.js","sources":["../../../src/main/integrations/additional-context.ts"],"sourcesContent":["import { defineIntegration } from '@sentry/core';\nimport { DeviceContext } from '@sentry/types';\nimport { app, screen as electronScreen } from 'electron';\n\nimport { mergeEvents } from '../merge';\n\nexport interface AdditionalContextOptions {\n  screen: boolean;\n}\n\nconst DEFAULT_OPTIONS: AdditionalContextOptions = {\n  screen: true,\n};\n\n/**\n * Adds additional Electron context to events\n */\nexport const additionalContextIntegration = defineIntegration((userOptions: Partial<AdditionalContextOptions> = {}) => {\n  const _lazyDeviceContext: DeviceContext = {};\n\n  const options = {\n    ...DEFAULT_OPTIONS,\n    ...userOptions,\n  };\n\n  function _setPrimaryDisplayInfo(): void {\n    const display = electronScreen.getPrimaryDisplay();\n    const width = Math.floor(display.size.width * display.scaleFactor);\n    const height = Math.floor(display.size.height * display.scaleFactor);\n    _lazyDeviceContext.screen_density = display.scaleFactor;\n    _lazyDeviceContext.screen_resolution = `${width}x${height}`;\n  }\n\n  return {\n    name: 'AdditionalContext',\n    setup() {\n      // Some metrics are only available after app ready so we lazily load them\n      app.whenReady().then(\n        () => {\n          const { screen } = options;\n\n          if (screen) {\n            _setPrimaryDisplayInfo();\n\n            electronScreen.on('display-metrics-changed', () => {\n              _setPrimaryDisplayInfo();\n            });\n          }\n        },\n        () => {\n          // ignore\n        },\n      );\n    },\n    processEvent(event) {\n      const device: DeviceContext = _lazyDeviceContext;\n\n      return mergeEvents(event, { contexts: { device } });\n    },\n  };\n});\n"],"names":["electronScreen","screen"],"mappings":";;;;AAUA,MAAM,eAAe,GAA6B;AAChD,IAAA,MAAM,EAAE,IAAI;CACb;AAED;;AAEG;AACU,MAAA,4BAA4B,GAAG,iBAAiB,CAAC,CAAC,WAAA,GAAiD,EAAE,KAAI;IACpH,MAAM,kBAAkB,GAAkB,EAAE;AAE5C,IAAA,MAAM,OAAO,GAAG;AACd,QAAA,GAAG,eAAe;AAClB,QAAA,GAAG,WAAW;KACf;AAED,IAAA,SAAS,sBAAsB,GAAA;AAC7B,QAAA,MAAM,OAAO,GAAGA,MAAc,CAAC,iBAAiB,EAAE;AAClD,QAAA,MAAM,KAAK,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,KAAK,GAAG,OAAO,CAAC,WAAW,CAAC;AAClE,QAAA,MAAM,MAAM,GAAG,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,WAAW,CAAC;AACpE,QAAA,kBAAkB,CAAC,cAAc,GAAG,OAAO,CAAC,WAAW;QACvD,kBAAkB,CAAC,iBAAiB,GAAG,CAAA,EAAG,KAAK,CAAI,CAAA,EAAA,MAAM,EAAE;;IAG7D,OAAO;AACL,QAAA,IAAI,EAAE,mBAAmB;QACzB,KAAK,GAAA;;AAEH,YAAA,GAAG,CAAC,SAAS,EAAE,CAAC,IAAI,CAClB,MAAK;AACH,gBAAA,MAAM,UAAEC,QAAM,EAAE,GAAG,OAAO;AAE1B,gBAAA,IAAIA,QAAM,EAAE;AACV,oBAAA,sBAAsB,EAAE;AAExB,oBAAAD,MAAc,CAAC,EAAE,CAAC,yBAAyB,EAAE,MAAK;AAChD,wBAAA,sBAAsB,EAAE;AAC1B,qBAAC,CAAC;AACH;aACF,EACD,MAAK;;AAEL,aAAC,CACF;SACF;AACD,QAAA,YAAY,CAAC,KAAK,EAAA;YAChB,MAAM,MAAM,GAAkB,kBAAkB;AAEhD,YAAA,OAAO,WAAW,CAAC,KAAK,EAAE,EAAE,QAAQ,EAAE,EAAE,MAAM,EAAE,EAAE,CAAC;SACpD;KACF;AACH,CAAC;;;;"}