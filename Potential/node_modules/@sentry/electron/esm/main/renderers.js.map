{"version":3,"file":"renderers.js","sources":["../../src/main/renderers.ts"],"sourcesContent":["import { normalizeUrlToBase } from '@sentry/utils';\nimport { app } from 'electron';\n\ninterface Renderer {\n  id: number;\n  url?: string;\n  title?: string;\n}\n\nlet RENDERERS: Map<number, Renderer> | undefined;\n\n/**\n * Enable tracking of renderer properties via events\n *\n * This allows us to get the last known state of a renderer even if it's been destroyed\n **/\nexport function trackRendererProperties(): void {\n  if (RENDERERS) {\n    return;\n  }\n\n  const renderers = (RENDERERS = new Map<number, Renderer>());\n\n  function updateUrl(id: number, url: string): void {\n    const state = renderers.get(id) || { id };\n    state.url = normalizeUrlToBase(url, app.getAppPath());\n    renderers.set(id, state);\n  }\n\n  function updateTitle(id: number, title: string): void {\n    const state = renderers.get(id) || { id };\n    state.title = title;\n    renderers.set(id, state);\n  }\n\n  app.on('web-contents-created', (_, contents) => {\n    const id = contents.id;\n\n    contents.on('did-navigate', (_, url) => updateUrl(id, url));\n    contents.on('did-navigate-in-page', (_, url) => updateUrl(id, url));\n    contents.on('page-title-updated', (_, title) => updateTitle(id, title));\n\n    contents.on('destroyed', () => {\n      // We need to delay since consumers of this API sometimes need to\n      // access the state shortly after a renderer is destroyed\n      setTimeout(() => {\n        renderers.delete(id);\n      }, 5000);\n    });\n  });\n}\n\n/** Gets the properties for a renderer */\nexport function getRendererProperties(id: number): Renderer | undefined {\n  return RENDERERS?.get(id);\n}\n"],"names":[],"mappings":";;;AASA,IAAI,SAA4C;AAEhD;;;;AAII;SACY,uBAAuB,GAAA;AACrC,IAAA,IAAI,SAAS,EAAE;QACb;AACD;IAED,MAAM,SAAS,IAAI,SAAS,GAAG,IAAI,GAAG,EAAoB,CAAC;AAE3D,IAAA,SAAS,SAAS,CAAC,EAAU,EAAE,GAAW,EAAA;AACxC,QAAA,MAAM,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,EAAE;AACzC,QAAA,KAAK,CAAC,GAAG,GAAG,kBAAkB,CAAC,GAAG,EAAE,GAAG,CAAC,UAAU,EAAE,CAAC;AACrD,QAAA,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,KAAK,CAAC;;AAG1B,IAAA,SAAS,WAAW,CAAC,EAAU,EAAE,KAAa,EAAA;AAC5C,QAAA,MAAM,KAAK,GAAG,SAAS,CAAC,GAAG,CAAC,EAAE,CAAC,IAAI,EAAE,EAAE,EAAE;AACzC,QAAA,KAAK,CAAC,KAAK,GAAG,KAAK;AACnB,QAAA,SAAS,CAAC,GAAG,CAAC,EAAE,EAAE,KAAK,CAAC;;IAG1B,GAAG,CAAC,EAAE,CAAC,sBAAsB,EAAE,CAAC,CAAC,EAAE,QAAQ,KAAI;AAC7C,QAAA,MAAM,EAAE,GAAG,QAAQ,CAAC,EAAE;AAEtB,QAAA,QAAQ,CAAC,EAAE,CAAC,cAAc,EAAE,CAAC,CAAC,EAAE,GAAG,KAAK,SAAS,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;AAC3D,QAAA,QAAQ,CAAC,EAAE,CAAC,sBAAsB,EAAE,CAAC,CAAC,EAAE,GAAG,KAAK,SAAS,CAAC,EAAE,EAAE,GAAG,CAAC,CAAC;AACnE,QAAA,QAAQ,CAAC,EAAE,CAAC,oBAAoB,EAAE,CAAC,CAAC,EAAE,KAAK,KAAK,WAAW,CAAC,EAAE,EAAE,KAAK,CAAC,CAAC;AAEvE,QAAA,QAAQ,CAAC,EAAE,CAAC,WAAW,EAAE,MAAK;;;YAG5B,UAAU,CAAC,MAAK;AACd,gBAAA,SAAS,CAAC,MAAM,CAAC,EAAE,CAAC;aACrB,EAAE,IAAI,CAAC;AACV,SAAC,CAAC;AACJ,KAAC,CAAC;AACJ;AAEA;AACM,SAAU,qBAAqB,CAAC,EAAU,EAAA;AAC9C,IAAA,OAAO,SAAS,EAAE,GAAG,CAAC,EAAE,CAAC;AAC3B;;;;"}